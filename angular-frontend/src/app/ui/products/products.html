<div class="products-container" *ngIf="!loading; else loadingTpl">
    <div class="header-actions">
        <h2>Product Catalogue</h2>
        <button *ngIf="authService.isAdmin()" class="btn btn-primary" (click)="toggleAddForm()">+ Add Product</button>
    </div>

    <!-- Admin Form -->
    <div class="form-overlay" *ngIf="showForm">
        <div class="form-container">
            <h3>{{ editingProduct?.id ? 'Edit Product' : 'Add New Product' }}</h3>
            <div class="form-group">
                <label>Name</label>
                <input type="text" [(ngModel)]="editingProduct!.name" placeholder="Product Name">
            </div>
            <div class="form-group">
                <label>Price</label>
                <input type="number" [(ngModel)]="editingProduct!.price" placeholder="Price">
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <input type="number" [(ngModel)]="editingProduct!.quantity" placeholder="Initial Quantity">
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
                <button class="btn btn-primary" (click)="saveProduct()">Save</button>
            </div>
        </div>
    </div>

    <div class="product-grid">
        <div *ngFor="let product of products" class="product-card">
            <div class="card-content">
                <div class="card-header">
                    <h3>{{ product.name }}</h3>
                    <div class="admin-actions" *ngIf="authService.isAdmin()">
                        <button class="btn-icon" (click)="editProduct(product)" title="Edit">‚úèÔ∏è</button>
                        <button class="btn-icon delete" (click)="deleteProduct(product)" title="Delete">üóëÔ∏è</button>
                    </div>
                </div>
                <p class="price">{{ product.price | currency:'USD' }}</p>
                <p class="quantity">Available: {{ product.quantity }}</p>

                <button *ngIf="!authService.isAdmin()" class="btn-buy" (click)="addToCart(product)">Add to Cart</button>

                <!-- Added to Cart Feedback Pill -->
                <div class="cart-feedback" *ngIf="!authService.isAdmin() && getCartCount(product) > 0">
                    <span class="check-icon">‚úì</span>
                    <span class="feedback-text">
                        Added to Cart
                        <span *ngIf="getCartCount(product) > 1" class="count-badge">x{{ getCartCount(product) }}</span>
                    </span>
                </div>
            </div>
        </div>

        <div *ngIf="products.length === 0" class="no-products" style="grid-column: 1 / -1;">
            <p>No products available.</p>
        </div>
    </div>
</div>

<ng-template #loadingTpl>
    <div class="products-container">
        <div class="no-products">
            <p>Loading catalogue...</p>
        </div>
    </div>
</ng-template>